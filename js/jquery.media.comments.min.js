/*
 *  Project: jQuery Media Comments
 *  Description: jQuery pluggin to add media query functionality to HTML comments
 *  Author: Steve Podmore (https://twitter.com/StevenPodmore)
 *  License: 
 */

;(function(e,t,n,r){function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="mediacomments",s={timeout:500};o.prototype={init:function(){var n=this;if(!e(n.element).attr("id")){e(n.element).attr("id",this.randString(10))}var r=false;e(t).resize(function(){if(r!==false){clearTimeout(r)}r=setTimeout(function(){n.doQuery(n.element,n.options)},n.options.timeout)});e(t).trigger("resize")},doQuery:function(n,r){var i=this;var s=e(n);var o=this.getComments(s.get(0));e(o).each(function(n,r){var s=this.nodeValue.match(/[^\r\n]+/g)[0];if(s.match(/@media/g)){var o=t.matchMedia(e.trim(s.replace(/@media/g,"")));var u=e("#mc"+e(i.element).attr("id")+n).length==0;if(o.matches&&u){var a=e.parseHTML(this.nodeValue.replace(s,""));e(a).attr("id","mc"+e(i.element).attr("id")+n).insertAfter(this)}if(!o.matches){e("#mc"+e(i.element).attr("id")+n).remove()}}})},getComments:function(e){function n(e){if(e.nodeType==8){t.push(e)}else{for(var r=0,i=e.childNodes.length;r<i;++r){n(e.childNodes[r])}}}var t=[];n(e);return t},randString:function(e){if(!e){e=5}var t="";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var r=0;r<e;r++){t+=n.charAt(Math.floor(Math.random()*n.length))}return t}};e.fn[i]=function(t){var n=Array.prototype.slice.call(arguments,1);return this.each(function(){var r=e(this),s=r.data("mediacomments");if(!s){r.data(i,new o(this,t))}else{if(typeof t==="string"){s[t].apply(s,n)}}})}})(jQuery,window,document)
})( jQuery, window, document );